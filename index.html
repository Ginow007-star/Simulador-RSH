<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulador CSE ‚Äì RSH (Profesional)</title>

<style>
:root{
  --primario:#0033A0;
  --secundario:#E6ECF5;
  --acento:#F59E0B;
  --exito:#16A34A;
  --alerta:#D97706;
  --peligro:#DC2626;
  --texto:#1F2937;
}

body{
  font-family:Arial,Helvetica,sans-serif;
  background:var(--secundario);
  padding:20px;
  color:var(--texto)
}

.card{
  max-width:1100px;
  margin:auto;
  background:#fff;
  padding:25px;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,.1)
}

h1{margin-top:0;color:var(--primario)}
h2{margin-top:25px;border-bottom:2px solid var(--primario);color:var(--primario)}

label{
  display:block;
  margin-top:10px;
  font-weight:bold;
  color:var(--primario)
}

input,select{
  width:100%;
  padding:8px;
  margin-top:4px;
  border:1px solid #CBD5E1;
  border-radius:6px
}

button{
  margin-top:15px;
  padding:10px 14px;
  border:none;
  border-radius:8px;
  background:var(--primario);
  color:#fff;
  font-size:15px;
  cursor:pointer
}

button.sec{background:#64748B;margin-left:10px}
button.pdf{background:#0F766E;margin-left:10px}

.member{
  border:1px solid #CBD5E1;
  padding:15px;
  border-radius:8px;
  margin-top:15px;
  background:#F8FAFC
}

.result{
  margin-top:25px;
  padding:18px;
  border-radius:8px
}

.green{background:#DCFCE7;border-left:6px solid var(--exito)}
.yellow{background:#FEF9C3;border-left:6px solid var(--acento)}
.orange{background:#FFEDD5;border-left:6px solid var(--alerta)}
.red{background:#FEE2E2;border-left:6px solid var(--peligro)}

.note{font-size:13px;color:#374151;margin-top:10px}
.small{font-size:12px;color:#6B7280}
</style>
</head>

<body>
<div class="card" id="contenido">

<h1>Simulador Profesional de Calificaci√≥n Socioecon√≥mica (CSE)</h1>
<p class="note">
Herramienta referencial basada en criterios p√∫blicos del Registro Social de Hogares (RSH).  
No reemplaza evaluaci√≥n oficial ni resoluci√≥n administrativa.
</p>

<h2>1. Jefe/a de hogar</h2>

<label>Edad</label>
<input id="edadJefe" type="number">

<label>Discapacidad / dependencia</label>
<select id="condicionJefe">
  <option value="ninguna">No</option>
  <option value="leve">Leve</option>
  <option value="moderada">Moderada</option>
  <option value="severa">Severa</option>
</select>

<label>Ocupaci√≥n</label>
<select id="ocupJefe">
  <option value="no_trabaja">Inactivo / No trabaja</option>
  <option value="cesante">Cesante</option>
  <option value="dependiente">Trabajador dependiente</option>
  <option value="independiente">Trabajador independiente / honorarios</option>
  <option value="estudia">Estudiante</option>
  <option value="estudia_trabaja">Estudia y trabaja</option>
</select>

<label>Ingreso mensual l√≠quido ($)</label>
<input id="ingresoJefe" type="number" value="0">

<h2>2. Integrantes del hogar</h2>
<div id="members"></div>
<button type="button" id="btnAdd">‚ûï Agregar integrante</button>

<h2>3. Evaluaci√≥n de medios (reordenamiento)</h2>

<label>Bienes ra√≠ces adicionales</label>
<select id="bienes">
  <option value="0">No</option>
  <option value="1">S√≠</option>
</select>

<label>Sistema de salud</label>
<select id="sistemaSalud">
  <option value="fonasa">Fonasa</option>
  <option value="isapre">Isapre</option>
</select>

<label>Valor plan Isapre (UF)</label>
<input id="valorPlan" type="number" step="0.01">

<label>Veh√≠culo</label>
<select id="tieneVehiculo">
  <option value="no">No</option>
  <option value="si">S√≠</option>
</select>

<label>Valor comercial veh√≠culo ($)</label>
<input id="valorVehiculo" type="number">

<label>Educaci√≥n con copago</label>
<select id="educacion">
  <option value="no">No</option>
  <option value="si">S√≠</option>
</select>

<label>Copago mensual educaci√≥n ($)</label>
<input id="valorColegio" type="number">

<button type="button" id="btnCalc">Calcular CSE estimada</button>
<button type="button" class="pdf" onclick="exportarPDF()">üìÑ Exportar a PDF</button>

<div id="resultado"></div>
<div id="analisis" class="note"></div>

</div>

<script>
let memberId=0;

function crearIntegrante(){
  memberId++;
  const d=document.createElement('div');
  d.className='member';
  d.dataset.id=memberId;
  d.innerHTML=`
    <strong>Integrante</strong>
    <button type="button" class="sec" data-remove="${memberId}">Eliminar</button>

    <label>Edad</label>
    <input type="number" class="edad">

    <label>Discapacidad</label>
    <select class="condicion">
      <option value="ninguna">No</option>
      <option value="leve">Leve</option>
      <option value="moderada">Moderada</option>
      <option value="severa">Severa</option>
    </select>

    <label>Ingreso mensual l√≠quido ($)</label>
    <input type="number" class="ingreso" value="0">
  `;
  document.getElementById('members').appendChild(d);
}

/* Coeficientes de necesidades (aprox. RSH) */
function coef(edad,cond){
  if(isNaN(edad)) return 0;
  let base=0;
  if(edad<=5) base=0.4;
  else if(edad<=14) base=0.3;
  else if(edad<=17) base=0.09;
  else if(edad<=59) base=0;
  else if(edad<=74) base=0.61;
  else base=0.75;

  if(cond==='leve') base+=0.34;
  if(cond==='moderada') base+=0.52;
  if(cond==='severa') base+=0.64;

  return base;
}

function calcular(){
  let edades=[],conds=[];
  let ingresoTotal=0;

  if(!isNaN(parseInt(edadJefe.value))){
    edades.push(parseInt(edadJefe.value));
    conds.push(condicionJefe.value);
  }
  ingresoTotal+=parseFloat(ingresoJefe.value)||0;

  document.querySelectorAll('.member').forEach(m=>{
    const e=parseInt(m.querySelector('.edad').value);
    if(!isNaN(e)){
      edades.push(e);
      conds.push(m.querySelector('.condicion').value);
    }
    ingresoTotal+=parseFloat(m.querySelector('.ingreso').value)||0;
  });

  const N=edades.length||1;
  let sumY=0;
  edades.forEach((e,i)=>sumY+=coef(e,conds[i]));
  const IN=Math.pow(N,0.7)+sumY;

  let ingresoEq=ingresoTotal/IN;

  let alertas=[];
  if(bienes.value==='1') alertas.push('Bienes ra√≠ces adicionales');
  if(sistemaSalud.value==='isapre' && valorPlan.value>=4) alertas.push('Isapre alto costo');
  if(tieneVehiculo.value==='si' && valorVehiculo.value>=25000000) alertas.push('Veh√≠culo alto valor');
  if(educacion.value==='si' && valorColegio.value>=150000) alertas.push('Educaci√≥n con copago alto');

  if(alertas.length>0) ingresoEq*=1.15;

  let tramo='',clase='';
  if(ingresoEq<250000){tramo='0‚Äì40%';clase='green'}
  else if(ingresoEq<400000){tramo='41‚Äì60%';clase='yellow'}
  else if(ingresoEq<600000){tramo='61‚Äì80%';clase='orange'}
  else{tramo='81‚Äì100%';clase='red'}

  resultado.innerHTML=`
  <div class="result ${clase}">
    <strong>√çndice de Necesidades (IN):</strong> ${IN.toFixed(2)}<br>
    <strong>Ingreso total hogar:</strong> $${ingresoTotal.toFixed(0)}<br>
    <strong>Ingreso equivalente corregido:</strong> $${ingresoEq.toFixed(0)}<br>
    <strong>Tramo CSE estimado:</strong> ${tramo}
  </div>`;

  analisis.innerHTML=`
  <strong>An√°lisis socioecon√≥mico</strong><br>
  Hogar compuesto por ${N} integrante(s).  
  El √çndice de Necesidades se calcul√≥ considerando econom√≠as de escala (N<sup>0,7</sup>) y coeficientes etarios y de discapacidad.<br><br>
  El ingreso l√≠quido total del hogar asciende a $${ingresoTotal.toFixed(0)}.  
  Tras el ajuste por IN${alertas.length>0?' y evaluaci√≥n de medios ('+alertas.join(', ')+')':''},
  el hogar se ubica de manera referencial en el tramo <strong>${tramo}</strong> de la CSE.
  `;
}

function exportarPDF(){
  const v=window.open('','','width=800,height=600');
  v.document.write('<html><head><title>Resultado CSE</title></head><body>');
  v.document.write(document.getElementById('contenido').innerHTML);
  v.document.write('</body></html>');
  v.document.close();
  v.print();
}

document.getElementById('btnAdd').addEventListener('click',crearIntegrante);
document.getElementById('btnCalc').addEventListener('click',calcular);

document.getElementById('members').addEventListener('click',e=>{
  if(e.target.dataset.remove){
    const m=document.querySelector(".member[data-id='"+e.target.dataset.remove+"']");
    if(m) m.remove();
  }
});

crearIntegrante();
</script>

</body>
</html>
